# Test advanced filtering capabilities
[!mock-server] skip 'mock server not available'
[!scenario:basic] skip 'test scenario not available'

# Test date-based filtering with relative dates
exec gh-comment list 123 --since '1 hour ago' --repo test-owner/test-repo --dry-run
# Should show recent comments (mock comments are created with current time)
stdout 'Comments on PR #123'
stdout 'test-user'
stdout 'This looks good to me!'
stdout 'Please fix the typo'
! stderr .

# Test date-based filtering with absolute dates
exec gh-comment list 123 --since '2023-01-01' --repo test-owner/test-repo --dry-run
stdout 'Comments on PR #123'
stdout 'This looks good to me!'
! stderr .

# Test date range filtering
exec gh-comment list 123 --since '2023-01-01' --until '2025-12-31' --repo test-owner/test-repo --dry-run
stdout 'Comments on PR #123'
stdout 'This looks good to me!'
! stderr .

# Test author wildcard patterns
exec gh-comment list 123 --author 'test*' --repo test-owner/test-repo --dry-run
stdout 'Comments on PR #123'
stdout 'This looks good to me!'
! stderr .

# Test email-style author filtering
exec gh-comment list 123 --author '*@test.com' --repo test-owner/test-repo --dry-run
stdout 'No comments found on PR #123'
! stderr .

# Test comment type filtering - review comments only
exec gh-comment list 123 --type review --repo test-owner/test-repo --dry-run
stdout 'Comments on PR #123'
stdout 'Please fix the typo'
! stderr .

# Test comment type filtering - issue comments only  
exec gh-comment list 123 --type issue --repo test-owner/test-repo --dry-run
stdout 'Comments on PR #123'
stdout 'This looks good to me!'
! stderr .

# Test status filtering (open/resolved/all)
exec gh-comment list 123 --status open --repo test-owner/test-repo --dry-run
stdout 'Comments on PR #123'
stdout 'This looks good to me!'
! stderr .

exec gh-comment list 123 --status all --repo test-owner/test-repo --dry-run
stdout 'Comments on PR #123'
stdout 'This looks good to me!'
stdout 'Please fix the typo'
! stderr .

# Test multiple filter combinations
exec gh-comment list 123 --author 'reviewer' --type review --since '1 day ago' --repo test-owner/test-repo --dry-run
stdout 'Comments on PR #123'
stdout 'Please fix the typo'
! stderr .

# Test case-insensitive author matching
exec gh-comment list 123 --author 'REVIEWER' --repo test-owner/test-repo --dry-run
stdout 'Comments on PR #123'
stdout 'Please fix the typo'
! stderr .

# Test partial author matching
exec gh-comment list 123 --author 'review' --repo test-owner/test-repo --dry-run
stdout 'Comments on PR #123'
stdout 'Please fix the typo'
! stderr .

# Test filtering with no results
exec gh-comment list 123 --author 'nonexistent' --repo test-owner/test-repo --dry-run
stdout 'No comments found on PR #123'
! stderr .