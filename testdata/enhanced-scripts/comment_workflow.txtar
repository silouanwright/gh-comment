# Test comprehensive comment workflow with mock GitHub API
[!mock-server] skip 'mock server not available'
[!scenario:basic] skip 'test scenario not available'

# Test listing comments - use dry run to avoid API calls
exec gh-comment list 123 --repo test-owner/test-repo --dry-run
stdout 'Comments on PR #123'
stdout 'This looks good to me!'
stdout 'Please fix the typo'
! stderr .

# Test adding a line-specific comment (now uses review command)
exec gh-comment review 123 'Code review feedback' --comment src/api.js:89:'This rate limiting logic needs improvement' --repo test-owner/test-repo --dry-run
stdout 'Would create review on PR #123'
stdout 'Comments: 1'
! stderr .

# Test adding a general discussion comment
exec gh-comment add 123 'Great work on this PR!' --repo test-owner/test-repo --dry-run
stdout 'Would add general comment to PR #123'
stdout 'Great work on this PR!'
! stderr .

# Verify list command works with filters (dry run)
exec gh-comment list 123 --repo test-owner/test-repo --dry-run
stdout 'Comments on PR #123'
stdout 'This looks good to me!'
! stderr .

# Test filtering by author (dry run)
exec gh-comment list 123 --author test-user --repo test-owner/test-repo --dry-run
stdout 'Comments on PR #123'
stdout 'This looks good to me!'
! stderr .

# Test filtering by author with wildcard (dry run)
exec gh-comment list 123 --author 'test*' --repo test-owner/test-repo --dry-run
stdout 'Comments on PR #123'
stdout 'This looks good to me!'
! stderr .