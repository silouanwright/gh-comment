# Test comprehensive comment workflow with mock GitHub API
[!mock-server] skip 'mock server not available'
[!scenario:basic] skip 'test scenario not available'

# Test listing comments - should show pre-existing comments from scenario
exec gh-comment list 123 --repo test-owner/test-repo
stdout 'This looks good to me!'
stdout 'Please fix the typo in line 42'
stdout 'src/main.go:L42'
! stderr .

# Test adding a line-specific comment
exec gh-comment add 123 src/api.js 89 'This rate limiting logic needs improvement' --repo test-owner/test-repo --dry-run
stdout 'Would add comment to src/api.js:89'
stdout 'This rate limiting logic needs improvement'
! stderr .

# Test adding a line-specific comment (without dry-run to test API call)
exec gh-comment add 123 src/test.js 1 'Great work on this PR!' --repo test-owner/test-repo
stdout 'âœ“ Added comment to src/test.js:1'
! stderr .

# Verify the comment was added by listing again
exec gh-comment list 123 --repo test-owner/test-repo
stdout 'Great work on this PR!'
stdout 'This looks good to me!'
! stderr .

# Test filtering by author
exec gh-comment list 123 --author test-user --repo test-owner/test-repo
stdout 'This looks good to me!'
! stdout 'Please fix the typo'

# Test filtering by author with wildcard
exec gh-comment list 123 --author 'test*' --repo test-owner/test-repo
stdout 'This looks good to me!'
! stderr .